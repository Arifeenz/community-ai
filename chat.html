<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <title>AI ‡πÅ‡∏ä‡∏ó‡∏ä‡∏∏‡∏°‡∏ä‡∏ô</title>
    <style>
      body {
        font-family: sans-serif;
        padding: 20px;
      }
      #chat {
        border: 1px solid #ccc;
        padding: 10px;
        height: 300px;
        overflow-y: auto;
      }
      .msg {
        margin: 5px 0;
      }
      .ai {
        color: darkblue;
      }
      .user {
        color: darkgreen;
      }
      button {
        margin-top: 10px;
        padding: 10px;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <h2>üí¨ ‡πÅ‡∏ä‡∏ó‡∏Å‡∏±‡∏ö AI</h2>
    <div id="chat"></div>
    <button onclick="startListening()">üéô ‡∏û‡∏π‡∏î‡∏ï‡∏≠‡∏ö AI</button>

    <script>
      // ‡πÇ‡∏´‡∏•‡∏î‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏∏‡∏°‡∏ä‡∏ô
      const communityName =
        localStorage.getItem("communityName") || "‡∏ä‡∏∏‡∏°‡∏ä‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì";
      const chatBox = document.getElementById("chat");

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏á‡πÅ‡∏ä‡∏ó
      function addMessage(text, sender) {
        const div = document.createElement("div");
        div.className = "msg " + sender;
        div.textContent = text;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      // ‡∏û‡∏π‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏ó‡∏¢‡∏ú‡πà‡∏≤‡∏ô Google Translate TTS
      // function speakThai(text) {
      //   const audio = new Audio(
      //     "https://translate.google.com/translate_tts?ie=UTF-8&tl=th&client=tw-ob&q=" + encodeURIComponent(text)
      //   );
      //   audio.play();
      // }
      function speakThai(text) {
        if ("speechSynthesis" in window) {
          const utterance = new SpeechSynthesisUtterance(text);
          utterance.lang = "th-TH";

          const voices = speechSynthesis
            .getVoices()
            .filter((v) => v.lang.startsWith("th"));
          if (voices.length > 0) {
            utterance.voice = voices[0];
          }

          speechSynthesis.speak(utterance);
        } else {
          const audio = new Audio(
            "https://translate.google.com/translate_tts?ie=UTF-8&tl=th&client=tw-ob&q=" +
              encodeURIComponent(text)
          );
          audio.oncanplaythrough = () => audio.play();
        }
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á
      const SpeechRecognition =
        window.SpeechRecognition || window.webkitSpeechRecognition;
      const recognition = new SpeechRecognition();
      recognition.lang = "th-TH";
      recognition.interimResults = false;

      recognition.onresult = function (event) {
        const text = event.results[0][0].transcript;
        addMessage(text, "user");
        // ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á text ‡πÑ‡∏õ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô server ‡∏´‡∏£‡∏∑‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ
      };

      recognition.onerror = function (event) {
        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + event.error);
      };

      function startListening() {
        recognition.start();
      }

      // ‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤
      const greeting = `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏ä‡∏∏‡∏°‡∏ä‡∏ô ${communityName} ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á‡∏Ñ‡∏£‡∏±‡∏ö`;
      addMessage(greeting, "ai");
      speakThai(greeting);
    </script>
  </body>
</html>
