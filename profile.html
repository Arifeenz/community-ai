<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ä‡∏∏‡∏°‡∏ä‡∏ô</title>
    <style>
      /* ---------- Theme Tokens ---------- */
      :root {
        --bg: #f6f7fb;
        --card: #ffffff;
        --text: #0f172a;
        --muted: #64748b;
        --border: #e2e8f0;
        --primary: #16a34a;
        --primary-600: #15803d;
        --accent: #06b6d4;
        --ai: #fce4ec;
        --ai-text: #ad1457;
        --user: #c8e6c9;
        --user-text: #1b5e20;
        --shadow: 0 10px 30px rgba(15, 23, 42, 0.12);
        --ring: #22c55e;
      }
      :root.theme-dark {
        --bg: #0b1220;
        --card: #0f172a;
        --text: #e5e7eb;
        --muted: #9ca3af;
        --border: #243041;
        --primary: #22c55e;
        --primary-600: #16a34a;
        --accent: #22d3ee;
        --ai: #2b1d24;
        --ai-text: #f8b4c8;
        --user: #19321b;
        --user-text: #b7f7bf;
        --shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
        --ring: #22c55e;
      }

      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, "Segoe UI", Roboto,
          "Noto Sans Thai", "Noto Sans", Arial, sans-serif;
        color: var(--text);
        background: radial-gradient(
            1000px 600px at 10% 0%,
            rgba(34, 197, 94, 0.08),
            transparent
          ),
          radial-gradient(
            1000px 600px at 90% 100%,
            rgba(6, 182, 212, 0.08),
            transparent
          ),
          var(--bg);
        padding: 20px;
        transition: background 0.25s ease, color 0.2s ease;
      }

      /* ---------- Layout ---------- */
      .container {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        gap: 24px;
        grid-template-columns: 1fr 320px; /* main + sidebar */
      }
      @media (max-width: 960px) {
        .container {
          grid-template-columns: 1fr;
        }
      }

      .card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 18px;
        box-shadow: var(--shadow);
        padding: 20px;
      }

      /* ---------- Header ---------- */
      .page-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        margin-bottom: 16px;
      }
      .title {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .logo {
        width: 42px;
        height: 42px;
        border-radius: 12px;
        display: grid;
        place-items: center;
        background: linear-gradient(135deg, var(--primary), var(--accent));
        color: #fff;
        font-weight: 700;
      }
      h1 {
        margin: 0;
        font-size: clamp(20px, 2.5vw, 28px);
      }
      .meta {
        color: var(--muted);
        font-size: 14px;
        margin-top: 4px;
      }

      /* ---------- Sidebar ---------- */
      .sidebar h2 {
        margin: 0 0 10px;
      }
      .activity-box {
        border: 1px solid var(--border);
        background: color-mix(in srgb, var(--card) 90%, var(--bg));
        border-radius: 12px;
        padding: 12px;
        margin-bottom: 12px;
      }
      .preview .activity-box {
        outline: 2px dashed color-mix(in srgb, var(--ring) 40%, transparent);
      }

      /* ---------- AI content ---------- */
      #aiContentBox {
        display: none;
      }
      .ai-card {
        background: color-mix(in srgb, var(--card) 85%, var(--ai));
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 16px;
      }
      .ai-actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 10px;
      }
      .btn {
        appearance: none;
        border: none;
        cursor: pointer;
        padding: 10px 14px;
        border-radius: 10px;
        font-weight: 600;
        background: var(--primary);
        color: #fff;
        transition: transform 0.03s, background 0.15s, opacity 0.15s,
          box-shadow 0.15s;
        box-shadow: 0 4px 14px rgba(34, 197, 94, 0.25);
      }
      .btn:hover {
        background: var(--primary-600);
      }
      .btn.secondary {
        background: #6b7280;
        box-shadow: none;
      }
      .btn.fb {
        background: #4267b2;
      }
      .btn:active {
        transform: translateY(1px);
      }

      /* ---------- Chat ---------- */
      .chat-button {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--primary);
        color: #fff;
        padding: 14px 20px;
        border-radius: 999px;
        font-size: 16px;
        cursor: pointer;
        box-shadow: var(--shadow);
        z-index: 1000;
        border: none;
      }
      #chatBox {
        position: fixed;
        bottom: 90px;
        right: 20px;
        width: min(360px, 92vw);
        height: 500px;
        display: none;
        flex-direction: column;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 14px;
        box-shadow: var(--shadow);
        z-index: 999;
      }
      #chatMessages {
        flex: 1;
        overflow-y: auto;
        padding: 12px;
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .bubble {
        max-width: 85%;
        padding: 8px 12px;
        border-radius: 12px;
        margin: 2px 0;
        word-wrap: break-word;
        line-height: 1.35;
        border: 1px solid var(--border);
      }
      .ai {
        align-self: flex-start;
        background: var(--ai);
        color: var(--ai-text);
      }
      .user {
        align-self: flex-end;
        background: var(--user);
        color: var(--user-text);
      }
      #chatInput {
        display: flex;
        border-top: 1px solid var(--border);
      }
      #chatInput input {
        flex: 1;
        padding: 12px;
        border: none;
        background: transparent;
        color: var(--text);
        outline: none;
      }
      #chatInput button {
        border: none;
        background: var(--primary);
        color: #fff;
        padding: 0 14px;
        cursor: pointer;
      }
      #voiceBtn {
        background: #f59e0b;
        border-bottom-right-radius: 14px;
      }

      /* ---------- Theme Toggle ---------- */
      .theme-toggle {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        background: transparent;
        color: var(--text);
        border: 1px solid var(--border);
        padding: 8px 12px;
        border-radius: 999px;
        cursor: pointer;
      }
      .theme-toggle:hover {
        background: color-mix(in srgb, var(--bg) 60%, transparent);
      }
      .theme-toggle svg {
        width: 18px;
        height: 18px;
        display: block;
      }

      /* ---------- Utilities ---------- */
      .row {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
      }
      .muted {
        color: var(--muted);
      }
      pre,
      textarea {
        white-space: pre-wrap;
      }

      #chatInput input {
        font-size: 16px; /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Safari auto zoom ‡∏ö‡∏ô iOS */
        flex: 1;
        padding: 12px;
        border: none;
        background: transparent;
        color: var(--text);
        outline: none;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Main -->
      <section class="card">
        <header class="page-header">
          <div class="title">
            <div class="logo" aria-hidden="true">‡∏ä</div>
            <div>
              <h1 id="communityTitle">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ä‡∏∏‡∏°‡∏ä‡∏ô</h1>
              <div class="meta">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡∏ï‡πå</div>
            </div>
          </div>
          <button
            id="themeToggle"
            class="theme-toggle"
            type="button"
            aria-pressed="false"
          >
            <span id="themeIcon" aria-hidden="true"></span>
            <span id="themeText">‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏ß‡πà‡∏≤‡∏á</span>
          </button>
        </header>

        <div class="row muted" style="gap: 18px; margin-bottom: 10px">
          <div>üë• ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å: 125 ‡∏Ñ‡∏ô</div>
          <div>üìÖ ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô 28 ‡∏Å.‡∏Ñ. 2025</div>
          <div>üì¢ ‡∏Ç‡πà‡∏≤‡∏ß‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®: ‡πÄ‡∏ä‡∏¥‡∏ç‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏õ‡∏•‡∏π‡∏Å‡∏õ‡πà‡∏≤ 10 ‡∏™.‡∏Ñ. 2025</div>
        </div>

        <div id="aiContentBox" class="ai-card">
          <h2 style="margin: 0 0 8px">üì¢ ‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏Å AI</h2>
          <p id="aiGeneratedContent"></p>
          <div class="muted" style="font-size: 12px">
            üí° ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏û‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°/‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÑ‡∏î‡πâ‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á
          </div>
          <div class="ai-actions">
            <button class="btn secondary" onclick="copyPostText()">
              üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
            </button>
            <button class="btn fb" onclick="openFacebookPost()">
              üì§ ‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ö‡∏ô Facebook
            </button>
          </div>
        </div>
      </section>

      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="card">
          <h2>‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h2>
          <div id="activityList"></div>
        </div>
        <div class="card preview" style="margin-top: 16px">
          <h2>‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÉ‡∏´‡∏°‡πà (Preview)</h2>
          <div id="activityPreview"></div>
        </div>
      </aside>
    </div>

    <!-- Chat -->
    <div id="chatBox">
      <div id="chatMessages"></div>
      <div id="chatInput">
        <input
          type="text"
          id="userMsg"
          placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏î üé§..."
        />
        <button onclick="sendMsg()">‡∏™‡πà‡∏á</button>
        <button id="voiceBtn" onclick="startVoice()">üé§</button>
      </div>
    </div>
    <button class="chat-button" onclick="toggleChat()">üí¨ ‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡∏û‡∏•‡∏≠‡∏¢‡πÉ‡∏™</button>

    <script>
      /* ---------- Init Community Title ---------- */
      const communityName =
        localStorage.getItem("communityName") || "‡∏ä‡∏∏‡∏°‡∏ä‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì";
      document.getElementById("communityTitle").textContent =
        "üè° " + communityName;

      /* ---------- Elements ---------- */
      const chatBox = document.getElementById("chatBox");
      const chatMessages = document.getElementById("chatMessages");
      const userInput = document.getElementById("userMsg");
      const activityPreview = document.getElementById("activityPreview");
      const activityList = document.getElementById("activityList");

      /* ---------- Theme Toggle ---------- */
      const root = document.documentElement;
      const tBtn = document.getElementById("themeToggle");
      const tIcon = document.getElementById("themeIcon");
      const tText = document.getElementById("themeText");

      function themeIcon(mode) {
        const sun =
          '<svg viewBox="0 0 24 24" fill="none"><path d="M12 4V2m0 20v-2M4 12H2m20 0h-2M5 5 3.6 3.6M20.4 20.4 19 19m0-14 1.4-1.4M5 19 3.6 20.4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><circle cx="12" cy="12" r="4" stroke="currentColor" stroke-width="2"/></svg>';
        const moon =
          '<svg viewBox="0 0 24 24" fill="none"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>';
        tIcon.innerHTML = mode === "dark" ? moon : sun;
        tText.textContent = mode === "dark" ? "‡πÇ‡∏´‡∏°‡∏î‡∏°‡∏∑‡∏î" : "‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏ß‡πà‡∏≤‡∏á";
        tBtn.setAttribute("aria-pressed", mode === "dark");
      }
      function applyTheme(mode) {
        root.classList.toggle("theme-dark", mode === "dark");
        themeIcon(mode);
        try {
          localStorage.setItem("theme", mode);
        } catch (e) {}
      }
      function detectTheme() {
        const saved = localStorage.getItem("theme");
        if (saved) return saved;
        return window.matchMedia &&
          window.matchMedia("(prefers-color-scheme: dark)").matches
          ? "dark"
          : "light";
      }
      (function initTheme() {
        applyTheme(detectTheme());
      })();
      tBtn.addEventListener("click", () =>
        applyTheme(root.classList.contains("theme-dark") ? "light" : "dark")
      );

      /* ---------- Chat & Flow ---------- */
      let step = 0;
      let selectedType = "activity";
      let currentData = {};
      let editingIndex = null;

      const templates = {
        activity: [
          "‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£‡∏Ñ‡∏∞?",
          "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á‡∏Ñ‡∏∞?",
          "‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏à‡∏±‡∏î‡∏ß‡∏±‡∏ô‡πÑ‡∏´‡∏ô‡∏Ñ‡∏∞?",
          "‡∏à‡∏±‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô? (‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î)",
          "‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏´‡∏°? ‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡πà‡∏≤‡∏Ñ‡∏∞?",
        ],
        place: [
          "‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤‡∏≠‡∏∞‡πÑ‡∏£‡∏Ñ‡∏∞?",
          "‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏ï‡∏≥‡∏ö‡∏•/‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÑ‡∏´‡∏ô‡∏Ñ‡∏∞?",
          "‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à‡∏ö‡πâ‡∏≤‡∏á?",
          "‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÑ‡∏á‡πÑ‡∏î‡πâ‡∏ö‡πâ‡∏≤‡∏á?",
          "‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î‡∏ß‡∏±‡∏ô‡πÑ‡∏´‡∏ô? ‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏î?",
          "‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏ä‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏Ñ‡∏∞?",
        ],
        restaurant: [
          "‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£‡∏Ñ‡∏∞?",
          "‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô?",
          "‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á?",
          "‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î‡∏ß‡∏±‡∏ô‡πÑ‡∏´‡∏ô? ‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏î?",
          "‡∏°‡∏µ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏ã‡πÄ‡∏ä‡∏µ‡∏¢‡∏•‡∏°‡∏µ‡πÄ‡∏î‡∏µ‡∏¢‡πÑ‡∏´‡∏°‡∏Ñ‡∏∞?",
        ],
        hotel: [
          "‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°/‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤‡∏≠‡∏∞‡πÑ‡∏£‡∏Ñ‡∏∞?",
          "‡∏ï‡∏±‡πâ‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô‡∏Ñ‡∏∞?",
          "‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô‡∏Ñ‡∏∞?",
          "‡∏°‡∏µ‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å‡πÅ‡∏ö‡∏ö‡πÉ‡∏î‡∏ö‡πâ‡∏≤‡∏á? ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?",
          "‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å‡πÑ‡∏î‡πâ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡πÉ‡∏î‡∏ö‡πâ‡∏≤‡∏á‡∏Ñ‡∏∞?",
        ],
      };

      function speakThai(text) {
        const cleaned = text.replace(
          /[\p{Emoji_Presentation}\p{Emoji}\u200d]+/gu,
          ""
        );
        if ("speechSynthesis" in window) {
          const u = new SpeechSynthesisUtterance(cleaned);
          u.lang = "th-TH";
          const voices = speechSynthesis
            .getVoices()
            .filter((v) => v.lang.startsWith("th"));
          if (voices.length > 0) u.voice = voices[0];
          speechSynthesis.speak(u);
        }
      }

      function addBubble(text, sender) {
        const div = document.createElement("div");
        div.className = "bubble " + sender;
        div.textContent = text;
        chatMessages.appendChild(div);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      function toggleChat() {
        const visible = chatBox.style.display === "flex";
        chatBox.style.display = visible ? "none" : "flex";
        if (!visible && chatMessages.childElementCount === 0) {
          const greeting = `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡πà‡∏∞‡∏ä‡∏∏‡∏°‡∏ä‡∏ô ${communityName} ‡∏û‡∏•‡∏≠‡∏¢‡πÉ‡∏™‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏∞ üå∏`;
          addBubble(greeting, "ai");
          speakThai(greeting);
          setTimeout(() => {
            const ask =
              "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏≤‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡∏ï‡πå‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô‡∏Ñ‡∏∞ (‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°, ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß, ‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£, ‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°)?";
            addBubble(ask, "ai");
            speakThai(ask);
          }, 1200);
        }
      }

      function sendMsg(text) {
        const message = text || userInput.value.trim();
        if (!message) return;
        addBubble(message, "user");
        userInput.value = "";

        if (editingIndex !== null) {
          currentData[editingIndex] = message;
          editingIndex = null;
          showPreview();
          return;
        }

        if (step === 0) {
          if (["‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°", "activity"].includes(message))
            selectedType = "activity";
          else if (["‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà", "‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß", "place"].includes(message))
            selectedType = "place";
          else if (["‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£", "restaurant"].includes(message))
            selectedType = "restaurant";
          else if (["‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°", "‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å", "hotel"].includes(message))
            selectedType = "hotel";
          else {
            reply(
              "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° / ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß / ‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£ / ‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°"
            );
            return;
          }
          step = 1;
          currentData = {};
          askNext();
        } else {
          const questions = templates[selectedType];
          currentData[step - 1] = message;
          step++;
          if (step <= questions.length) {
            askNext();
          } else {
            showPreview();
            step = 0;
          }
        }
      }

      function askNext() {
        const q = templates[selectedType][step - 1];
        addBubble(q, "ai");
        speakThai(q);
      }
      function reply(text) {
        addBubble(text, "ai");
        speakThai(text);
      }

      function showPreview() {
        const labels = templates[selectedType];
        let html = '<div class="activity-box">';
        labels.forEach((label, i) => {
          html += `<p><b>${label}</b> ${
            currentData[i] || ""
          } <button class="btn secondary" style="padding:4px 8px" onclick="editField(${i})">‚úèÔ∏è</button></p>`;
        });
        html += `<div class="row"><button class="btn" onclick="confirmActivity()">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button></div></div>`;
        activityPreview.innerHTML = html;
        reply(
          "‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πà‡∏∞ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢ ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢"
        );
      }

      function editField(index) {
        editingIndex = index;
        const q = templates[selectedType][index];
        reply("‡∏ï‡∏Å‡∏•‡∏á‡∏Ñ‡πà‡∏∞ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡∏°‡πà‡∏ô‡∏∞‡∏Ñ‡∏∞");
        setTimeout(() => reply(q), 600);
      }

      function confirmActivity() {
        const labels = templates[selectedType];
        let html = '<div class="activity-box">';
        labels.forEach((label, i) => {
          html += `<p><b>${label}</b> ${currentData[i] || ""}</p>`;
        });
        html += `<div class="row"><button class="btn" onclick="generateContent()">‚ú® ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏î‡πâ‡∏ß‡∏¢ AI</button></div></div>`;
        const div = document.createElement("div");
        div.className = "activity-box";
        div.innerHTML = html;
        activityList.prepend(div);
        activityPreview.innerHTML = "";
        reply("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞ üéâ");
      }

      async function generateContent() {
        const labels = templates[selectedType];
        let prompt = `‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏´‡∏°‡∏ß‡∏î "${selectedType}" ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ:\n`;
        labels.forEach(
          (label, i) => (prompt += `- ${label}: ${currentData[i] || "-"}\n`)
        );

        reply("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏à‡∏≤‡∏Å AI ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...");
        try {
          const backendUrl =
            location.hostname === "localhost"
              ? "http://localhost:3001/generate"
              : "/api/generate";
          const res = await fetch(backendUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ prompt }),
          });
          const data = await res.json();
          const content = data.content;
          if (content) {
            document.getElementById("aiGeneratedContent").textContent = content;
            document.getElementById("aiContentBox").style.display = "block";
            reply(
              "‡∏û‡∏•‡∏≠‡∏¢‡πÉ‡∏™‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞ ‡∏•‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏î‡∏π‡∏ô‡∏∞‡∏Ñ‡∏∞ üòä"
            );
          } else {
            reply("‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ");
          }
        } catch (err) {
          console.error(err);
          reply("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ AI");
        }
      }

      function startVoice() {
        if (!("webkitSpeechRecognition" in window)) {
          alert("‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Speech Recognition");
          return;
        }
        const recognition = new webkitSpeechRecognition();
        recognition.lang = "th-TH";
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;
        recognition.start();
        recognition.onresult = (e) => {
          const transcript = e.results[0][0].transcript;
          sendMsg(transcript);
        };
        recognition.onerror = (e) => console.error("Voice error:", e.error);
      }

      userInput.addEventListener("keydown", function (event) {
        if (event.key === "Enter") {
          event.preventDefault();
          sendMsg();
        }
      });

      function copyPostText() {
        const content = document.getElementById("aiGeneratedContent").innerText;
        navigator.clipboard
          .writeText(content)
          .then(() =>
            alert("üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ô‡∏≥‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÉ‡∏ô‡πÇ‡∏û‡∏™‡∏ï‡πå Facebook")
          )
          .catch(() => alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å"));
      }

      function openFacebookPost() {
        const content = document.getElementById("aiGeneratedContent").innerText;
        const fbUrl = `https://www.facebook.com/sharer/sharer.php?quote=${encodeURIComponent(
          content
        )}`;
        window.open(fbUrl, "_blank");
      }
    </script>
  </body>
</html>
