<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <title>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ä‡∏∏‡∏°‡∏ä‡∏ô</title>
    <style>
      body {
        font-family: sans-serif;
        padding: 20px;
        display: flex;
        flex-wrap: wrap;
        gap: 30px;
      }

      h1 {
        color: darkgreen;
      }
      .profile {
        flex: 1;
      }
      .sidebar {
        width: 300px;
      }
      .activity-box {
        border: 1px solid #ccc;
        border-radius: 8px;
        padding: 10px;
        margin-bottom: 10px;
        background: #f9f9f9;
      }
      .chat-button {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: darkgreen;
        color: white;
        padding: 15px 25px;
        border-radius: 50px;
        font-size: 16px;
        cursor: pointer;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
      }
      #chatBox {
        position: fixed;
        bottom: 80px;
        right: 20px;
        width: 320px;
        height: 450px;
        background: #fff;
        border: 1px solid #ccc;
        border-radius: 10px;
        display: none;
        flex-direction: column;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      }
      #chatMessages {
        flex: 1;
        overflow-y: auto;
        padding: 10px;
        display: flex;
        flex-direction: column;
      }
      .bubble {
        max-width: 80%;
        padding: 8px 12px;
        border-radius: 12px;
        margin: 4px 0;
        word-wrap: break-word;
      }
      .ai {
        align-self: flex-start;
        background: #fce4ec;
        color: #ad1457;
      }
      .user {
        align-self: flex-end;
        background: #c8e6c9;
        color: #1b5e20;
      }
      #chatInput {
        display: flex;
      }
      #chatInput input {
        flex: 1;
        padding: 8px;
        border: none;
        border-top: 1px solid #ccc;
        border-bottom-left-radius: 10px;
      }
      #chatInput button {
        padding: 8px 12px;
        border: none;
        border-top: 1px solid #ccc;
        background: darkgreen;
        color: white;
        cursor: pointer;
      }
      #voiceBtn {
        background: orange;
        border-bottom-right-radius: 10px;
      }
    </style>
  </head>
  <body>
    <div class="sidebar">
      <h2>‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h2>
      <div id="activityList"></div>
      <h2>‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÉ‡∏´‡∏°‡πà (Preview)</h2>
      <div id="activityPreview"></div>
    </div>

    <div class="profile">
      <h1 id="communityTitle"></h1>
      <p>üë• ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å: 125 ‡∏Ñ‡∏ô</p>
      <p>üìÖ ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô 28 ‡∏Å.‡∏Ñ. 2025</p>
      <p>üì¢ ‡∏Ç‡πà‡∏≤‡∏ß‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®: ‡πÄ‡∏ä‡∏¥‡∏ç‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏õ‡∏•‡∏π‡∏Å‡∏õ‡πà‡∏≤ 10 ‡∏™.‡∏Ñ. 2025</p>
    </div>

    <div
      id="aiContentBox"
      style="
        display: none;
        flex: 1;
        padding: 20px;
        background: #fff8dc;
        border: 1px solid #ccc;
        border-radius: 10px;
      "
    >
      <h2>üì¢ ‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏Å AI</h2>
      <p id="aiGeneratedContent" style="white-space: pre-wrap"></p>
      <button
        onclick="shareToFacebook()"
        style="
          margin-top: 10px;
          background: #4267b2;
          color: white;
          padding: 10px 20px;
          border: none;
          border-radius: 5px;
          cursor: pointer;
        "
      >
        üì§ ‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏õ Facebook
      </button>
      <p style="font-size: 12px; color: gray; margin-top: 10px">
        üí°
        ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏™‡πà‡∏†‡∏≤‡∏û‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á
      </p>
    </div>

    <div id="chatBox">
      <div id="chatMessages"></div>
      <div id="chatInput">
        <input
          type="text"
          id="userMsg"
          placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏î üé§..."
        />
        <button onclick="sendMsg()">‡∏™‡πà‡∏á</button>
        <button id="voiceBtn" onclick="startVoice()">üé§</button>
      </div>
    </div>

    <div class="chat-button" onclick="openChat()">üí¨ ‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡∏û‡∏•‡∏≠‡∏¢‡πÉ‡∏™</div>

    <script>
      const communityName =
        localStorage.getItem("communityName") || "‡∏ä‡∏∏‡∏°‡∏ä‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì";
      document.getElementById("communityTitle").textContent =
        "üè° " + communityName;

      const chatBox = document.getElementById("chatBox");
      const chatMessages = document.getElementById("chatMessages");
      const userInput = document.getElementById("userMsg");
      const activityPreview = document.getElementById("activityPreview");
      const activityList = document.getElementById("activityList");

      let step = 0;
      let selectedType = "activity";
      let currentData = {};
      let editingIndex = null;

      const templates = {
        activity: [
          "‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£‡∏Ñ‡∏∞?",
          "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á‡∏Ñ‡∏∞?",
          "‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏à‡∏±‡∏î‡∏ß‡∏±‡∏ô‡πÑ‡∏´‡∏ô‡∏Ñ‡∏∞?",
          "‡∏à‡∏±‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô? (‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î)",
          "‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏´‡∏°? ‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡πà‡∏≤‡∏Ñ‡∏∞?",
        ],
        place: [
          "‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤‡∏≠‡∏∞‡πÑ‡∏£‡∏Ñ‡∏∞?",
          "‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏ï‡∏≥‡∏ö‡∏•/‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÑ‡∏´‡∏ô‡∏Ñ‡∏∞?",
          "‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à‡∏ö‡πâ‡∏≤‡∏á?",
          "‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÑ‡∏á‡πÑ‡∏î‡πâ‡∏ö‡πâ‡∏≤‡∏á?",
          "‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î‡∏ß‡∏±‡∏ô‡πÑ‡∏´‡∏ô? ‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏î?",
          "‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏ä‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏Ñ‡∏∞?",
        ],
        restaurant: [
          "‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£‡∏Ñ‡∏∞?",
          "‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô?",
          "‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á?",
          "‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î‡∏ß‡∏±‡∏ô‡πÑ‡∏´‡∏ô? ‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏î?",
          "‡∏°‡∏µ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏ã‡πÄ‡∏ä‡∏µ‡∏¢‡∏•‡∏°‡∏µ‡πÄ‡∏î‡∏µ‡∏¢‡πÑ‡∏´‡∏°‡∏Ñ‡∏∞?",
        ],
        hotel: [
          "‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°/‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤‡∏≠‡∏∞‡πÑ‡∏£‡∏Ñ‡∏∞?",
          "‡∏ï‡∏±‡πâ‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô‡∏Ñ‡∏∞?",
          "‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô‡∏Ñ‡∏∞?",
          "‡∏°‡∏µ‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å‡πÅ‡∏ö‡∏ö‡πÉ‡∏î‡∏ö‡πâ‡∏≤‡∏á? ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?",
          "‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å‡πÑ‡∏î‡πâ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡πÉ‡∏î‡∏ö‡πâ‡∏≤‡∏á‡∏Ñ‡∏∞?",
        ],
      };

      function speakThai(text) {
        const cleaned = text.replace(
          /[\p{Emoji_Presentation}\p{Emoji}\u200d]+/gu,
          ""
        );
        if ("speechSynthesis" in window) {
          const utterance = new SpeechSynthesisUtterance(cleaned);
          utterance.lang = "th-TH";
          const voices = speechSynthesis
            .getVoices()
            .filter((v) => v.lang.startsWith("th"));
          if (voices.length > 0) utterance.voice = voices[0];
          speechSynthesis.speak(utterance);
        } else {
          const audio = new Audio(
            "https://translate.google.com/translate_tts?ie=UTF-8&tl=th&client=tw-ob&q=" +
              encodeURIComponent(cleaned)
          );
          audio.oncanplaythrough = () => audio.play();
        }
      }

      function addBubble(text, sender) {
        const div = document.createElement("div");
        div.className = "bubble " + sender;
        div.textContent = text;
        chatMessages.appendChild(div);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      function openChat() {
        chatBox.style.display = "flex";
        if (chatMessages.childElementCount === 0) {
          const greeting = `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡πà‡∏∞‡∏ä‡∏∏‡∏°‡∏ä‡∏ô ${communityName} ‡∏û‡∏•‡∏≠‡∏¢‡πÉ‡∏™‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏∞ üå∏`;
          addBubble(greeting, "ai");
          speakThai(greeting);
          setTimeout(() => {
            const ask =
              "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏≤‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡∏ï‡πå‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô‡∏Ñ‡∏∞ (‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°, ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß, ‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£, ‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°)?";
            addBubble(ask, "ai");
            speakThai(ask);
          }, 3000);
        }
      }

      function sendMsg(text) {
        const message = text || userInput.value.trim();
        if (!message) return;
        addBubble(message, "user");
        userInput.value = "";

        if (editingIndex !== null) {
          currentData[editingIndex] = message;
          editingIndex = null;
          showPreview();
          return;
        }

        if (step === 0) {
          if (["‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°", "activity"].includes(message))
            selectedType = "activity";
          else if (["‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà", "‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß", "place"].includes(message))
            selectedType = "place";
          else if (["‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£", "restaurant"].includes(message))
            selectedType = "restaurant";
          else if (["‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°", "‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å", "hotel"].includes(message))
            selectedType = "hotel";
          else {
            reply(
              "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏∞ ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß ‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£ ‡∏´‡∏£‡∏∑‡∏≠ ‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°"
            );
            return;
          }
          step = 1;
          currentData = {};
          askNext();
        } else {
          const questions = templates[selectedType];
          currentData[step - 1] = message;
          step++;
          if (step <= questions.length) {
            askNext();
          } else {
            showPreview();
            step = 0;
          }
        }
      }

      function askNext() {
        const question = templates[selectedType][step - 1];
        addBubble(question, "ai");
        speakThai(question);
      }

      function reply(text) {
        addBubble(text, "ai");
        speakThai(text);
      }

      function showPreview() {
        const labels = templates[selectedType];
        let html = '<div class="activity-box">';
        labels.forEach((label, i) => {
          html += `<p><b>${label}</b> ${
            currentData[i] || ""
          } <button onclick="editField(${i})">‚úèÔ∏è</button></p>`;
        });
        html += `<button onclick="confirmActivity()">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button></div>`;
        activityPreview.innerHTML = html;
        reply(
          "‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πà‡∏∞ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢ ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢"
        );
      }

      function editField(index) {
        editingIndex = index;
        const question = templates[selectedType][index];
        reply("‡∏ï‡∏Å‡∏•‡∏á‡∏Ñ‡πà‡∏∞ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡∏°‡πà‡∏ô‡∏∞‡∏Ñ‡∏∞");
        setTimeout(() => {
          reply(question);
        }, 800);
      }

      function confirmActivity() {
        const labels = templates[selectedType];
        let html = '<div class="activity-box">';
        labels.forEach((label, i) => {
          html += `<p><b>${label}</b> ${currentData[i] || ""}</p>`;
        });
        html += `<button onclick="generateContent()">‚ú® ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏î‡πâ‡∏ß‡∏¢ AI</button>`;
        html += "</div>";
        const div = document.createElement("div");
        div.className = "activity-box";
        div.innerHTML = html;
        activityList.prepend(div);
        activityPreview.innerHTML = "";
        reply("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞ üéâ");
      }

      async function generateContent() {
        const labels = templates[selectedType];
        let prompt = `‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏´‡∏°‡∏ß‡∏î "${selectedType}" ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ:\n`;
        labels.forEach((label, i) => {
          prompt += `- ${label}: ${currentData[i] || "-"}\n`;
        });

        reply("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏à‡∏≤‡∏Å AI ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...");

        try {
          const backendUrl =
            location.hostname === "localhost"
              ? "http://localhost:3001/generate"
              : "/api/generate";

          const res = await fetch(backendUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ prompt }),
          });

          const data = await res.json();
          const content = data.content;
          if (content) {
            document.getElementById("aiGeneratedContent").textContent = content;
            document.getElementById("aiContentBox").style.display = "block";
            reply(
              "‡∏û‡∏•‡∏≠‡∏¢‡πÉ‡∏™‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞ ‡∏•‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏ä‡∏≠‡∏ö‡πÑ‡∏´‡∏°‡∏ô‡∏∞‡∏Ñ‡∏∞ üòä"
            );
            speakThai(
              "‡∏û‡∏•‡∏≠‡∏¢‡πÉ‡∏™‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞ ‡∏•‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏ä‡∏≠‡∏ö‡πÑ‡∏´‡∏°‡∏ô‡∏∞‡∏Ñ‡∏∞"
            );
          } else {
            reply("‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ");
          }
        } catch (err) {
          console.error(err);
          reply("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ AI");
        }
      }

      function startVoice() {
        if (!("webkitSpeechRecognition" in window)) {
          alert("‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Speech Recognition");
          return;
        }
        const recognition = new webkitSpeechRecognition();
        recognition.lang = "th-TH";
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;
        recognition.start();

        recognition.onresult = function (event) {
          const transcript = event.results[0][0].transcript;
          sendMsg(transcript);
        };

        recognition.onerror = function (event) {
          console.error("Voice error:", event.error);
        };
      }

      userInput.addEventListener("keydown", function (event) {
        if (event.key === "Enter") {
          event.preventDefault();
          sendMsg();
        }
      });

      function shareToFacebook() {
        const content = document.getElementById("aiGeneratedContent").innerText;
        const url = location.origin;
        const fbUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(
          url
        )}&quote=${encodeURIComponent(content)}`;
        window.open(fbUrl, "_blank");
      }
    </script>
  </body>
</html>
